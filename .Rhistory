source("func.R"); a[-1,1] <- year_change_108_to_2019( as.Date(a[-1,1]) )
source("func.R"); a[-1,1] <- year_change_108_to_2019( as.Date(as.numeric(a[-1,1])) )
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date((a[-1,1]))
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date((a[-1,1])))
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date((a[-1,1])))
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
da <- ymd(1080401)
ye <- year(da)
ye <- ye + 1911
year(da) <- ye
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
View(stock_data)
source("func.R"); a[-1,1] <- year_change_108_to_2019( as.Date(as.numeric(a[-1,1])) )
View(a)
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
as.numeric(a[-1,1])
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
as.numeric(a[-1,1])
da <- ymd(as.numeric(a[-1,1]))
da
ye <- year(da)
ye <- ye + 1911
year(da) <- ye
da
da <- ymd(as.numeric(a[-1,1]))
da
rcsv <- NULL
for(y in c(100:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv; rm(rcsv_tmp, file_name_mon, file_name_wr, rcsv_tmp, mo, y, rcsv)
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
da <- ymd(as.numeric(a[-1,1]))
year(da) <- year(da) + 1911
a[-1,1] <- da
da
a[-1,1]
a[-1,1] <- da
a[-1,1]
a[-1,1] <- as.Date( da)
a[-1,1]
as.Date( da)
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
View(stock_data)
rcsv <- NULL
for(y in c(100:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv;
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
View(stock_data)
for(y in c(99:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv <- NULL
for(y in c(99:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv;
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
View(stock_data)
rcsv <- NULL
for(y in c(100:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv;
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
rm(rcsv_tmp, file_name_mon, file_name_wr, rcsv_tmp, mo, y, rcsv)
rm(rcsv_tmp, file_name_mon, file_name_wr, rcsv_tmp, mo, y, rcsv, a, da, ye)
chart(stock_data)
chartSeries(stock_data)
View(rcsv_mon)
a[2,1]
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
a[2,1]
a[2,2]
a[1,1]
a[1,2
a[1,2]
a[1,2]
chartSeries(stock_data, name = a[1,2])
View(a)
View(rcsv_mon)
file_path <- paste0(getwd(), "/data_DOHLCV/")
if(dir.exists(file_path) == FALSE){ dir.create(file_path)}
#install.packages( c("jsonlite", "lubridate", "quantmod"))
library(quantmod)
library(lubridate)
library(jsonlite)
library(rvest)
#------------------------------------daily data DOHLCV ----------------------------------------------
source("func.R"); stock_list <- get_stock_num_list("20190429")
source("func.R"); date_set <- get_date_set_all(2010)
file_path <- paste0(getwd(), "/data_DOHLCV/")
file_name <- paste0(file_path, stock_list[4],".csv")
if(dir.exists(file_path) == FALSE){ dir.create(file_path)}
source("DOHLCV.R"); update_DOHLCV(date_set[8:10], stock_list[3:4], file_path)
source("DOHLCV.R"); update_DOHLCV(date_set[1:2], stock_list[1:4], file_path)
source("DOHLCV.R"); update_DOHLCV(date_set[1:4], stock_list[1:4], file_path)
#------------------------------------eps estimate month-----------------------
rcsv <- NULL
for(y in c(100:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv;
View(rcsv_mon)
View(rcsv_mon)
a <- t(rcsv_mon)
# subset(df, V1=="1101")
# complete.cases(df)
# a[!is.na(a)]
# colSums(rcsv_mon)
rcsv_mon[,1]
# subset(df, V1=="1101")
# complete.cases(df)
# a[!is.na(a)]
# colSums(rcsv_mon)
rcsv_mon[,2]
# subset(df, V1=="1101")
# complete.cases(df)
# a[!is.na(a)]
# colSums(rcsv_mon)
bbb<-rcsv_mon[,2]
bbb[!is.na(bbb)]
colSums(bbb[!is.na(bbb)])
bbb
sum(bbb[!is.na(bbb)])
last(rcsv_mon)
last(rcsv_mon[,2])
last(rcsv_mon[,2]) <- sum(bbb[!is.na(bbb)])
length(rcsv_mon[,2])
rcsv_mon[length(rcsv_mon[,2]),2] <- sum(bbb[!is.na(bbb)])
rcsv_mon[length(rcsv_mon[,1]),1] <- "Total"
length(rcsv_mon)
length(rcsv_mon[1,])
rcsv_mon[length(rcsv_mon[,1]),1] <- "Total"
for(x in c(2:length(rcsv_mon[1,]))){
bbb<-rcsv_mon[,2]
rcsv_mon[length(rcsv_mon[,2]),2] <- sum(bbb[!is.na(bbb)])
length(rcsv_mon[1,])
}
# subset(df, V1=="1101")
# complete.cases(df)
# a[!is.na(a)]
# colSums(rcsv_mon)
rcsv_mon[length(rcsv_mon[,1]),1] <- "Total"
for(x in c(2:length(rcsv_mon[1,]))){
bbb<-rcsv_mon[,x]
rcsv_mon[length(rcsv_mon[,x]),x] <- sum(bbb[!is.na(bbb)])
}
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
rm(rcsv_tmp, file_name_mon, file_name_wr, rcsv_tmp, mo, y, rcsv, da, ye)
chartSeries(stock_data, name = a[1,2])
stock_data <- xts(as.numeric(subset(a, no=="1101")), order.by = as.Date(as.numeric(a[-1,1])))
stock_data <- xts(as.numeric(subset(rcsv_mon, no=="1101")), order.by = as.Date(as.numeric(a[-1,1])))
at <- t(a)
stock_data <- xts(as.numeric(subset(at, no=="1101")), order.by = as.Date(as.numeric(a[-1,1])))
View(at)
subset(at, no=="1101")
subset(at, select = on:1001)
subset(at, select = no:1001)
#------------------------------------eps estimate month-----------------------
rcsv <- NULL
for(y in c(100:108)){#99~108
for(mo in c(1:12)){#1~4
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
file_name_wr <- paste0(paste0(getwd(), "/data_MON/"), file_name_mon,".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp <- rcsv_tmp[!duplicated(rcsv_tmp),]
colnames(rcsv_tmp) <- c("no", paste0(file_name_mon, "01"))
if(is.null(rcsv)){rcsv <- rcsv_tmp}else{rcsv <- merge(rcsv_tmp, rcsv, by="no", all = TRUE)}
cat(y,mo,";")
}
};
rcsv_mon <- rcsv;
rcsv_mon[length(rcsv_mon[,1]),1] <- "Total"
for(x in c(2:length(rcsv_mon[1,]))){
bbb<-rcsv_mon[,x]
rcsv_mon[length(rcsv_mon[,x]),x] <- sum(bbb[!is.na(bbb)])
}
a[is.na(a)] <- 0
a <- t(rcsv_mon)
a[,1] <- as.numeric(row.names(a))
source("func.R"); a[-1,1] <- year_change_108_to_2019(as.numeric(a[-1,1]) )
# b <- a[-1,grepl("1101",a[1,])]
stock_data <- xts(as.numeric(a[-1,2]), order.by = as.Date(as.numeric(a[-1,1])))
stock_data <- xts(as.numeric(a[-1,grepl("Total",a[1,])]), order.by = as.Date(as.numeric(a[-1,1])))
rm(rcsv_tmp, file_name_mon, file_name_wr, rcsv_tmp, mo, y, rcsv, da, ye)
chartSeries(stock_data, name = a[1,grepl("Total",a[1,])],theme="black")
addBBands()
#------------------------------------eps estimate season-----------------------
rcsv <- NULL
for(y in c(99:108)){#99~108
for(z in c(1:4)){#1~4
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv_tmp <- read.csv(file_name_wr)
# rcsv <- rbind(rcsv, rcsv_tmp[1:length(rcsv_tmp$V1),1:20])
# tmp_sea <- as.character(rcsv$V1[1]);tmp_sea
cat(y,z,";")
}
}
View(rcsv_tmp)
file_path <- paste0(getwd(), "/data_DOHLCV/")
stockno <- c("2330")
date_1 <- c("20000101")
cat("  Doing stockno", stockno, "\n")
ttime <- as.character(as.integer(as.POSIXct(Sys.time()))*100)
historyStock <- NULL
sh_pe <- NULL
Sys.sleep(runif(1,2,4))#randomly delay 1 time between 2 and 3 seconds
url_1 <- paste0('http://www.tse.com.tw/exchangeReport/STOCK_DAY?',
'response=json&date=',date_1,'&stockNo=',stockno,'&_=',ttime)
jsondata <- fromJSON(url_1)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
(jsondata$data[, 3]/jsondata$data[, 2]),
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
Sys.sleep(runif(1,2,4))#randomly delay 1 time between 2 and 3 seconds
url_1 <- paste0('http://www.tse.com.tw/exchangeReport/STOCK_DAY?',
'response=json&date=',date_1,'&stockNo=',stockno,'&_=',ttime)
jsondata <- fromJSON(url_1)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
as.numeric(jsondata$data[, 3])/as.numeric(jsondata$data[, 2]),
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
View(tmpStock)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
View(historyStock)
colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock$Date <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock$Close <- historyStock$Value / historyStock$Volume
historyStock$Close <- historyStock$Value / historyStock$Volume
historyStock$Value
historyStock$Volume <- as.numeric(gsub(',', replacement = '', historyStock$Volume))
historyStock$Value <- as.numeric(gsub(',', replacement = '', historyStock$Value))
historyStock$Close <- historyStock$Value / historyStock$Volume
historyStock <- na.omit(historyStock)
stock_data <- xts(historyStock[, -1], order.by = as.Date(historyStock[, 1]))
View(stock_data)
chartSeries(stock_data)
chartSeries(stock_data$Close)
addTA(historyStock$Volume)
lines(historyStock$Volume)
lines(historyStock$Volume,as.Date(historyStock[, 1]), col="blue" )
lines(historyStock$Volume,as.Date(historyStock[, 1]), col="blue" )
chartSeries(stock_data$Close)
lines(historyStock$Volume,as.Date(historyStock[, 1]), col="blue" )
chartSeries(stock_data$Volume)
lines(stock_data$Close,as.Date(historyStock[, 1]), col="blue" )
chartSeries(stock_data$Value)
plot(historyStock[, 1],historyStock$Value)
plot(historyStock[, 1],historyStock$Value, col="blue")
plot(historyStock[, 1],historyStock$Value, col="blue")
line(historyStock[, 1],historyStock$Value)
lines(historyStock[, 1],historyStock$Value)
plot(historyStock[, 1],historyStock$Value, theme="black")
plot(historyStock[, 1],historyStock$Value)
lines(historyStock[, 1],historyStock$Value)
lines(historyStock[, 1],historyStock$Volume)
plot(historyStock[, 1],historyStock$Value)
lines(historyStock[, 1],historyStock$Value)
lines(historyStock[, 1],historyStock$Close)
plot(historyStock[, 1],historyStock$Close)
lines(historyStock[, 1],historyStock$Close)
plot(historyStock[, 1],historyStock$Value, bg="black")
lines(historyStock[, 1],historyStock$Value)
ggplot(historyStock[, 1],historyStock$Value)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 4:7],
jsondata$data[, 2:3],
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 4:7],
jsondata$data[, 2:3],
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
source("func.R"); sh_pe <- show_percet_len(sh_pe, date_1, date_set)
colnames(historyStock) <- c("Date", "Open", "High", "Low", "Close", "Volume", "Value")
source("func.R"); historyStock$Date <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock$Open <- as.numeric(gsub(',', replacement = '', historyStock$Open))
historyStock$High <- as.numeric(gsub(',', replacement = '', historyStock$High))
historyStock$Low <- as.numeric(gsub(',', replacement = '', historyStock$Low))
historyStock$Close <- as.numeric(gsub(',', replacement = '', historyStock$Close))
historyStock$Volume <- as.numeric(gsub(',', replacement = '', historyStock$Volume))
historyStock$Value <- as.numeric(gsub(',', replacement = '', historyStock$Value))
historyStock <- na.omit(historyStock)
stock_data <- xts(historyStock[, -1], order.by = as.Date(historyStock[, 1]))
# plot(historyStock[, 1],historyStock$Value)
# lines(historyStock[, 1],historyStock$Value)
# plot(historyStock[, 1],historyStock$Close)
# lines(historyStock[, 1],historyStock$Close)
#
chartSeries(stock_data)
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
View(historyStock)
colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock$Date <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock$Volume <- as.numeric(gsub(',', replacement = '', historyStock$Volume))
historyStock$Value <- as.numeric(gsub(',', replacement = '', historyStock$Value))
historyStock$Close <- historyStock$Value / historyStock$Volume
historyStock <- na.omit(historyStock)
View(historyStock)
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
# colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock[, 1] <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock[,2] <- as.numeric(gsub(',', replacement = '', historyStock[,2]))
historyStock[,3] <- as.numeric(gsub(',', replacement = '', historyStock[,3]))
historyStock[,4] <- historyStock[,3] / historyStock[,2]
historyStock <- rbind(c(NA, "Volume", "Value", "Price"), historyStock)
colnames(historyStock) <- c("Date", paste0(stockno,"_vo"), paste0(stockno,"_va"), paste0(stockno,"_pr"))
historyStock[,4] <- round(historyStock[,3] / historyStock[,2], 3)
historyStock <- NULL
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
# colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock[, 1] <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock[,2] <- as.numeric(gsub(',', replacement = '', historyStock[,2]))
historyStock[,3] <- as.numeric(gsub(',', replacement = '', historyStock[,3]))
historyStock[,4] <- round(historyStock[,3] / historyStock[,2], 3)
historyStock <- rbind(c(NA, "Volume", "Value", "Price"), historyStock)
colnames(historyStock) <- c("Date", paste0(stockno,"_vo"), paste0(stockno,"_va"), paste0(stockno,"_pr"))
daily_data <- NULL
if(is.null(daily_data)){daily_data <- historyStock}else{daily_data <- merge(historyStock, daily_data, by="Date", all = TRUE)}
View(daily_data)
stockno <- c("3034")
ttime <- as.character(as.integer(as.POSIXct(Sys.time()))*100)
historyStock <- NULL
url_1 <- paste0('http://www.tse.com.tw/exchangeReport/STOCK_DAY?',
'response=json&date=',date_1,'&stockNo=',stockno,'&_=',ttime)
jsondata <- fromJSON(url_1)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
# colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock[, 1] <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
View(jsondata)
stockno <- c("1101")
ttime <- as.character(as.integer(as.POSIXct(Sys.time()))*100)
historyStock <- NULL
url_1 <- paste0('http://www.tse.com.tw/exchangeReport/STOCK_DAY?',
'response=json&date=',date_1,'&stockNo=',stockno,'&_=',ttime)
jsondata <- fromJSON(url_1)
View(jsondata)
if(jsondata$stat == "OK"){
tmpStock <- data.frame(jsondata$data[, 1],
jsondata$data[, 2:3],
NA,
stringsAsFactors = FALSE)
historyStock <- rbind(historyStock, tmpStock)
}
# colnames(historyStock) <- c("Date", "Volume", "Value", "Close")
source("func.R"); historyStock[, 1] <- year_change_108_to_2019( as.Date(historyStock[, 1]) )
historyStock[,2] <- as.numeric(gsub(',', replacement = '', historyStock[,2]))
historyStock[,3] <- as.numeric(gsub(',', replacement = '', historyStock[,3]))
historyStock[,4] <- round(historyStock[,3] / historyStock[,2], 2)
historyStock <- rbind(c("No", "Volume", "Value", "Price"), historyStock)
colnames(historyStock) <- c("Date", paste0(stockno,"_vo"), paste0(stockno,"_va"), paste0(stockno,"_pr"))
View(historyStock)
historyStock <- rbind(c(NA, "Volume", "Value", "Price"), historyStock)
colnames(historyStock) <- c("Date", paste0(stockno,"_vo"), paste0(stockno,"_va"), paste0(stockno,"_pr"))
if(is.null(daily_data)){daily_data <- historyStock}else{daily_data <- merge(historyStock, daily_data, by="Date", all = TRUE)}
View(daily_data)
if(is.null(daily_data)){daily_data <- historyStock}else{daily_data <- merge(daily_data, historyStock,  by="Date", all = TRUE)}
historyStock <- rbind(c("NN", "Volume", "Value", "Price"), historyStock)
historyStock <- rbind(c("NNss", "Volume", "Value", "Price"), historyStock)
historyStock <- rbind(c("nono", "Volume", "Value", "Price"), historyStock)
