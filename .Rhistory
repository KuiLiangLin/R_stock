aaa <- html_text(html_nodes(stats, xpath = paste0('//body//center//center//table//tr//td//table[1]//tr[2]//td//table//tr[3]')))
#install.packages( c("jsonlite", "lubridate", "quantmod"))
library(quantmod)
aaa <- html_text(html_nodes(stats, xpath = paste0('//body//center//center//table//tr//td//table[1]//tr[2]//td//table//tr[3]')))
library(rvest)
aaa <- html_text(html_nodes(stats, xpath = paste0('//body//center//center//table//tr//td//table[1]//tr[2]//td//table//tr[3]')))
stats <- read_html("http://mops.twse.com.tw/nas/t21/sii/t21sc03_107_12_0.html", encoding = 'ISO-8859-1')
aaa <- html_text(html_nodes(stats, xpath = paste0('//body//center//center//table//tr//td//table[1]//tr[2]//td//table//tr[3]')))
aaa <- gsub(',', replacement = '', aaa)
substring(aaa, 139, 142)
substring(aaa, 1, 4)
bbb <- strsplit(aaa, " ")
View(bbb)
grep("[0-9]", aaa)
grep("[0-9]", bbb)
grep("[0-9]", bbb[[1]][1])
bbb[[1]][1]
grep("[ ]", bbb[[1]][1])
grep("[1 ]", bbb[[1]][1])
grep("[0 ]", bbb[[1]][1])
c <- grep("[0-9]", bbb[[1]][1])
c <- grep("[0-9]", bbb[[1]][1], value = TRUE)
c <- grep("[0-9]", bbb[[1]][2], value = TRUE)
c <- grep("[0-9]", bbb[[1]][14], value = TRUE)
is.numeric(c)
bbb[[1]][2]
length(c)
c <- grep("[0-9]", bbb[[1]][2], value = TRUE)
length(c)
d <- NULL
for(i in c(1:1000)){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- c(d, c)}
}
d <- NULL
for(i in c(1:1000)){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind.data.frame(d, c)}
}
d <- NULL
for(i in c(1:1000)){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
View(d)
dim(bbb)
dim(bbb[[1]])
length(bbb[[1]])
bbb[[1]]
bbb[[1]][118]
is.na(bbb[[1]][118])
is.na(bbb[[1]][117])
d <- substring(aaa, 1, 4)
bbb <- strsplit(aaa, " ")
for(i in c(2:length(bbb[[1]]))){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
View(d)
aaa <- html_text(html_nodes(stats, xpath = paste0('//body//center//center//table//tr//td//table[1]//tr[2]//td//table')))
aaa <- gsub(',', replacement = '', aaa)
aaa
d <- substring(aaa, 137, 141)
d <- substring(aaa, 138, 141)
d <- NULL
# d <- substring(aaa, 138, 141)
bbb <- strsplit(aaa, " ")
length(bbb[[1]])
for(i in c(1:length(bbb[[1]]))){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
View(d)
d[1]
substring(d[1], 138, 141)
substring(d[1], 139, 142)
d[1] <- substring(d[1], 139, 142)
strsplit(d[9], "-")
strsplit(d[9+9], "-")
strsplit(d[9+8], "-")
strsplit(d[9+8*4], "-")
last(strsplit(d[9+8*4], "-"))
last(strsplit(d[9+8*4], "-"))
strsplit(d[9+8*4], "-")[1]
strsplit(d[9+8*4], "-")[[1]][1]
last(strsplit(d[9+8*4], "-")[[1]][1])
last(strsplit(d[9+8*4], "-")[[1]])
length(d)
# d <- substring(aaa, 138, 141)
bbb <- strsplit(aaa, " ")
d <- NULL
for(i in c(1:length(bbb[[1]]))){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
View(bbb)
bbb
length(bbb[[1]]))
length(bbb[[1]])
c <- grep("[0-9]", bbb[[1]][988], value = TRUE)
length(c)==1
aaa
d[66]
d[65]
# d[9] <- gsub(',', replacement = '', aaa)
for(j in c(0:(length(d)-9)/8)){
d[9+8*j] <- last(strsplit(d[9+8*j], "-")[[1]])
}
View(d)
d[1] <- substring(d[1], 139, 142)
View(d)
# d <- substring(aaa, 138, 141)
bbb <- strsplit(aaa, " ")
d <- NULL
for(i in c(1:length(bbb[[1]]))){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
d[1] <- substring(d[1], 139, 142)
# d[9] <- gsub(',', replacement = '', aaa)
for(j in c(0:(length(d)-9)/8)){
d[9+8*j] <- last(strsplit(d[9+8*j], "-")[[1]])
d[9+8*j] <- substring(d[9+8*j], 139, 142)
}
# d <- substring(aaa, 138, 141)
bbb <- strsplit(aaa, " ")
bbb
d <- NULL
for(i in c(1:length(bbb[[1]]))){
c <- grep("[0-9]", bbb[[1]][i], value = TRUE)
if(length(c)==1){d <- cbind(d, c)}
}
View(d)
d[1] <- substring(d[1], 139, 142)
# d[9] <- gsub(',', replacement = '', aaa)
for(j in c(0:(length(d)-9)/8)){
d[9+8*j] <- last(strsplit(d[9+8*j], "-")[[1]])
d[9+8*j] <- substring(d[9+8*j], 1, 4)
}
f <- c(d[1], d[2])
for(k in c(1:(length(d)-9)/8)){
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
}
View(f)
d[57]
d[57]
d[56]
d[1]
d[9]
d[17]
c(d[1], d[2])
f <- c(d[1], d[2])
for(k in c(1:(length(d)-9)/8)){
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
}
View(f)
f <- c(d[1], d[2])
for(k in c(1:(length(d)-9)/8)){
f <- rbind(f, c(d[1+(8*k)], d[2+(8*k)]) )
}
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
f <- c(d[1], d[2])
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
f <- c(d[1], d[2])
k <- 2
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
f <- c(d[1], d[2])
for(k in c(1:(length(d)-9)/8)){
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
}
f <- c(d[1], d[2])
for(k in c(1:ceiling((length(d)-9)/8)){
for(k in c(1:ceiling((length(d)-9)/8))){
f <- rbind(f, c(d[1+8*k], d[2+8*k]) )
}
View(f)
library(rvest)
for(y in c(108:108)){#99~108
for(z in c(1:1)){#1~4
cat(paste0(";",y,"0",z))
Sys.sleep(runif(1,3,4))#randomly delay 1 time between 2 and 3 seconds
file_name_season <- paste0(y,"0",z)
source("SEASON_EPS.R");season_report_eps(file_name_season, y, z)
}
}
for(y in c(108:108)){#99~108
for(mo in c(4:4)){#1~12
cat(y,mo)
Sys.sleep(runif(1,2,4))#randomly delay 1 time between 2 and 3 seconds
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
source("MON_REV.R"); month_report_revenue(file_name_mon, y, mo)
}
}
for(y in c(108:108)){#99~108
for(mo in c(4:4)){#1~12
cat(y,mo)
Sys.sleep(runif(1,2,4))#randomly delay 1 time between 2 and 3 seconds
if(mo <= 9){file_name_mon <- paste0(y,"0",mo)}else{file_name_mon <- paste0(y,mo)}
source("MON_REV.R"); month_report_revenue(file_name_mon, y, mo)
}
}
#------------------------------------eps estimate-----------------------
y <- 108;z <- 1
file_name_season_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv <- read.csv(file_name_mon_wr)
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv <- read.csv(file_name_wr)
rcsv
rcsv[1,2]
tmp <- as.character(rcsv[1,1])
tmp
rcsv.V1
rcsv$V1
rcsv$V1[1]
rcsv$V1[2]
tmp <- as.character(rcsv$V1[2])
tmp <- as.character(rcsv$V1[2]);tmp
tmp <- as.character(rcsv$V3[2]);tmp
tmp_sea <- as.character(rcsv);tmp
rcsv <- read.csv(file_name_wr)
tmp_sea <- as.character(rcsv);tmp
tmp_sea <- as.character(rcsv);tmp_sea
rcsv <- read.csv(file_name_wr)
rcsv
# tmp_sea <- as.character(rcsv);tmp_sea
tmp_sea[,,1] <- rcsv
rcsv <- read.table(file_name_wr)
rcsv
# tmp_sea <- as.character(rcsv);tmp_sea
tmp_sea[,,1] <- rcsv
rcsv <- read.csv(file_name_wr)
rcsv
A <- array(1:24, c(3,4,2))
A[1,1,1]
A[,,1]
A[,,1] <- rcsv
rcsv[1] <- read.csv(file_name_wr)
View(rcsv)
rcsv[,,1] <- read.csv(file_name_wr)
rcsv[,,] <- read.csv(file_name_wr)
rcsv[1] <- read.csv(file_name_wr)
rcsv[2] <- read.csv(file_name_wr)
View(rcsv)
rcsv <- NULL
for(y in c(99:108)){#99~108
for(z in c(1:4)){#1~4
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv <- rbind(rcsv, read.csv(file_name_wr))
# tmp_sea <- as.character(rcsv$V1[1]);tmp_sea
}
}
View(rcsv)
rcsv <- NULL
for(y in c(99:108)){#99~108
for(z in c(1:4)){#1~4
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv <- rbind(rcsv, read.csv(file_name_wr))
# tmp_sea <- as.character(rcsv$V1[1]);tmp_sea
cat(y,z,";")
}
}
rcsv_tmp <- read.csv(file_name_wr)
rcsv_tmp$V1:$V20
rcsv_tmp$V1:V20
rcsv_tmp$(V1:V20)
rcsv_tmp[1,1]
rcsv_tmp[1:10,1:10]
last(rcsv_tmp$V1)
length(rcsv_tmp$V1)
rcsv_tmp[1:length(rcsv_tmp$V1),1:20]
rcsv <- NULL
for(y in c(99:108)){#99~108
for(z in c(1:4)){#1~4
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv <- rbind(rcsv, rcsv_tmp[1:length(rcsv_tmp$V1),1:20])
# tmp_sea <- as.character(rcsv$V1[1]);tmp_sea
cat(y,z,";")
}
}
View(rcsv)
a <- function()
a <- function(){
for(y in c(99:108)){#99~108
for(z in c(1:4)){#1~4
file_name_wr <- paste0(paste0(getwd(), "/data_SEASON/"), paste0(y,"0",z),".csv")
rcsv_tmp <- read.csv(file_name_wr)
rcsv <- rbind(rcsv, rcsv_tmp[1:length(rcsv_tmp$V1),1:20])
# tmp_sea <- as.character(rcsv$V1[1]);tmp_sea
cat(y,z,";")
}
}
}
try(a())
